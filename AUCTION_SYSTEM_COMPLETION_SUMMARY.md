# ุฎูุงุตูโ ุณุณุชู ุญุฑุงุฌ ุจุง ุถูุงูุชโูุงูู - ุชฺฉูู ุดุฏู โ

## ูุฑุญูู ุจู ูุฑุญูู ุขูฺู ุงูุฌุงู ุดุฏ

### โ ฑ. ุทุฑุงุญ ู ุณุงุฎุชุงุฑ ุฏุชุงุจุณ

**ูุงู:** `supabase/add-auction-guarantee-system.sql`

ุฌุฏุงูู ุงุฌุงุฏ ุดุฏู:
- `auction_participants` - ุดุฑฺฉุชโฺฉููุฏฺฏุงู ุจุง ุฑุชุจูโุจูุฏ
- `guarantee_deposits` - ุฑุฏุงุจ ุญู ุถูุงูุชโูุง
- `auction_winner_queue` - ุตู ูพุฑุฏุงุฎุช ุจุฑูุฏฺฏุงู
- `auction_payments` - ุชูุตูุงุช ูพุฑุฏุงุฎุชโูุง
- ุชุบุฑุงุช ุฌุฏูู `auction_details` ุจุฑุง ูุถุนุชโูุง ุฌุฏุฏ

**ุงูุฏฺฉุณโูุง:** ุจุฑุง ุนููฺฉุฑุฏ ุจูุชุฑ
**RLS Policies:** ุจุฑุง ุงููุช ุฏุชุงุจุณ

---

### โ ฒ. ุชุงูพโูุง TypeScript

**ูุงู:** `types.ts`

ุชุงูพโูุง ุฌุฏุฏ:
- `AuctionParticipant` - ูุนูููุงุช ุดุฑฺฉุชโฺฉููุฏู
- `GuaranteeDeposit` - ุญู ุถูุงูุช
- `AuctionWinnerQueue` - ุจุฑูุฏู ุฏุฑุตู
- `AuctionPayment` - ุชูุตูุงุช ูพุฑุฏุงุฎุช
- `AuctionStatus` - ูุถุนุชโูุง ุญุฑุงุฌ

---

### โ ณ. ุชูุงุจุน API ุงุตู

**ูุงู:** `services/auction-guarantee-system.ts`

#### ถ ุชุงุจุน ุงุตู:

1. **`checkGuaranteeDepositBalance()`**
   - ุจุฑุฑุณ ููุฌูุฏ ฺฉุงู (ต% ููุช ูพุงู)
   - ุจุฑฺฏุฑุฏุงูุฏู ูุถุนุช ู ูุจุงูุบ

2. **`placeBidWithGuaranteeDeposit()`**
   - ุซุจุช ูพุดููุงุฏ ุจุง ูฺฉุงูุฒู ุถูุงูุช
   - ูุณุฏูุฏ ฺฉุฑุฏู ต% ุจุฑุง ุงูููโุจุงุฑ
   - ูุณุฏูุฏ ฺฉุฑุฏู ูุจูุบ ูพุดููุงุฏ
   - ุงุทูุงุนโุฑุณุงู ุฎูุฏฺฉุงุฑ

3. **`processAuctionEnding()`**
   - ุฑุชุจูโุจูุฏ ุดุฑฺฉุชโฺฉููุฏฺฏุงู
   - ุงูุชุฎุงุจ ณ ุจุฑูุฏูโ ุงูู
   - ุฑูุงุณุงุฒ ุญู ุถูุงูุช ุฏฺฏุฑุงู
   - ุงุฌุงุฏ ุตู ูพุฑุฏุงุฎุช

4. **`checkAndProcessPaymentDeadlines()`**
   - ุจุฑุฑุณ ูููุชโูุง ูููุถ
   - ูุฑุงุฎูุงู ุดุฏู ุฏุฑ ูุฑ ุฑูุฑุด ุตูุญู
   - ุจุฏูู ูุงุฒ ุจู cron job

5. **`handleExpiredPaymentDeadline()`**
   - ุณูุฒุงูุฏู ุญู ุถูุงูุช
   - ุงุทูุงุนโุฑุณุงู ุจุฑูุฏูโ ุจุนุฏ
   - ูุบู ุญุฑุงุฌ ุงฺฏุฑ ฺฉุณ ูุจุงุดุฏ

6. **`processAuctionWinnerPayment()`**
   - ุชฺฉูู ูพุฑุฏุงุฎุช
   - ฺฉุณุฑ ฒ% ฺฉูุณูู
   - ูุงุฑุฒ ุจู ูุฑูุดูุฏู
   - ุงุฌุงุฏ ุฑฺฉูุฑุฏ ฺฉูุณูู

7. **`completeAuctionFlow()`**
   - ุชุดุฎุต ููุน ุฎุท
   - ุงุฌุงุฏ ูุฑูุงู ุฎุฑุฏ ุจุฑุง ุชุญูู
   - ุงุทูุงุนโุฑุณุงู ุทุฑูู

---

### โ ด. Components React

**ูุงู:** `components/AdminAuctionParticipantsPanel.tsx`
- ููุงุด ุชูุงู ุดุฑฺฉุชโฺฉููุฏฺฏุงู ุจุฑุง ุงุฏูู
- ุฑุชุจูโุจูุฏ ู ูุถุนุช ุญู ุถูุงูุช
- ุนูุงูุชโฺฏุฐุงุฑ ณ ุจุฑูุฏูโ ุงูู

**ูุงู:** `components/UserAuctionView.tsx`
- ููุงุด ุญูุงุธุชโุดุฏู ุจุฑุง ฺฉุงุฑุจุฑุงู ุนุงุฏ
- ุชููุง ุจุงูุงุชุฑู ูพุดููุงุฏ ู ูุงู ุจุฏุงุฑโฺฉููุฏู
- ุจุฑูุฒุฑุณุงู ูุฑ ณฐ ุซุงูู

---

### โ ต. Custom Hooks

**ูุงู:** `hooks/useAuctionPaymentChecker.ts`
- ุจุฑุฑุณ ุฎูุฏฺฉุงุฑ ูููุชโูุง ุฏุฑ ูุฑ ุฑูุฑุด
- ุงุฌุฑุง ุฎูุฏฺฉุงุฑ ุจุฏูู cron

---

### โ ถ. ูุณุชูุฏุงุช

**ูุงู:** `AUCTION_GUARANTEE_SYSTEM_IMPLEMENTATION.md`
- ุชูุถุญ ฺฉุงูู ูุฑ ุฌุฒุก
- ูุซุงูโูุง ุนูู
- ุฑุงูููุง ุงุณุชูุงุฏู

**ูุงู:** `AUCTION_GUARANTEE_INTEGRATION_GUIDE.md`
- ุฑุงูููุง ูุฑุญููโุจูโูุฑุญูู ฺฉูพุงุฑฺูโุณุงุฒ
- ฺฉุฏโูุง ููููู ุจุฑุง ูุฑ ุตูุญู
- ูฺฉุงุช ููู ู ูุตุญุชโูุง

---

## ุฌุฑุงู ฺฉุงูู ุณุณุชู

### ุจุฑุง ุดุฑฺฉุชโฺฉููุฏู:
```
ฑ. ูุดุงูุฏูโ ุญุฑุงุฌ (UserAuctionView: ุชููุง ุจุงูุงุชุฑู ูพุดููุงุฏ)
   โ
ฒ. ุซุจุช ูพุดููุงุฏ (placeBidWithGuaranteeDeposit)
   โข ุจุฑุฑุณ: ต% ุญู ุถูุงูุช + ูพุดููุงุฏ
   โข ุงฺฏุฑ ุงูู: ูุณุฏูุฏ ฺฉุฑุฏู ต%
   โข ูุณุฏูุฏ ฺฉุฑุฏู ูุจูุบ ูพุดููุงุฏ
   โ
ณ. ุงุทูุงุนโุฑุณุงู ุฎูุฏฺฉุงุฑ
```

### ุจุฑุง ุจุฑูุฏู:
```
ฑ. ูพุงุงู ุญุฑุงุฌ โ ุงุทูุงุนโุฑุณุงู ุจุฑูุฏู
   โ
ฒ. ูููุช ดธ ุณุงุนุช ูพุฑุฏุงุฎุช
   โข CheckAndProcessPaymentDeadlines (ูุฑ ุฑูุฑุด)
   โ
ณ. ุงฺฏุฑ ูพุฑุฏุงุฎุช ฺฉุฑุฏ: ุชฺฉูู (processAuctionWinnerPayment)
   โข ฒ% ฺฉูุณูู ฺฉุณุฑ
   โข ูุจูุบ ุจู ูุฑูุดูุฏู ูุงุฑุฒ
   โข ุดุฑูุน ุชุญูู ุฎุท (completeAuctionFlow)
   โ
ด. ุงฺฏุฑ ูพุฑุฏุงุฎุช ูฺฉุฑุฏ: ุฑูุชู ุจู ุจุฑูุฏูโ ุจุนุฏ
   โข ุณูุฒุงูุฏู ุญู ุถูุงูุช
   โข ุงุทูุงุนโุฑุณุงู ุจุฑูุฏูโ ุจุนุฏ
```

### ุจุฑุง ูุฏุฑ:
```
ฑ. ูุดุงูุฏูโ ุชูุงู ุดุฑฺฉุชโฺฉููุฏฺฏุงู (AdminAuctionParticipantsPanel)
   โข ูุงูุ ูพุดููุงุฏุ ุชุนุฏุงุฏุ ุญู ุถูุงูุช
   โ
ฒ. ูุฏุฑุช ูพุฑุฏุงุฎุชโูุง
   โ
ณ. ูุธุงุฑุช ุจุฑ ุญุฑุงุฌโูุง
```

---

## ูฺฺฏโูุง ฺฉูุฏ

### ๐ ุญุฑู ุฎุตูุต
- ฺฉุงุฑุจุฑุงู ุนุงุฏ: ุชููุง ุจุงูุงุชุฑู ูพุดููุงุฏ ู ูุงู ุจุฏุงุฑโฺฉููุฏู
- ูุฏุฑุงู: ูุณุช ฺฉุงูู ุชูุงู ุดุฑฺฉุชโฺฉููุฏฺฏุงู

### โฐ ุฎูุฏฺฉุงุฑโุณุงุฒ
- ูููุชโูุง ุจุฏูู cron ุจุฑุฑุณ ูโุดููุฏ
- ูุฑ ุฑูุฑุด ุตูุญู: `useAuctionPaymentChecker()` ุงุฌุฑุง ูโุดูุฏ
- ุชูุงู ุงุทูุงุนโุฑุณุงูโูุง ุฎูุฏฺฉุงุฑ

### ๐ฐ ุงููุช ูุงู
- ุชูุงู ูุจุงูุบ ูุณุฏูุฏ ู ุฑุฏุงุจ ูโุดููุฏ
- ุญู ุถูุงูุช ูุงุจู ุงุณุชูุงุฏู ูุณุช
- ฒ% ฺฉูุณูู ููุท ุงุฒ ุณุงุช
- ุฑุณุฏฺฏ ฺฉุงูู ุจู ุชูุงู ุชุฑุงฺฉูุดโูุง

### ๐ ุดูุงูโุณุงุฒ
- ูุถุนุช ูุงุถุญ ุจุฑุง ูุฑ ุญุฑุงุฌ
- ุฑุชุจูโุจูุฏ ุดูุงู ุจุฑูุฏฺฏุงู
- ุงุทูุงุนโุฑุณุงู ููุฑ

---

## ุชูุงู ูุงูโูุง ุงุฌุงุฏ ุดุฏู

1. โ `supabase/add-auction-guarantee-system.sql` - ฑณฒ ุฎุท
2. โ `services/auction-guarantee-system.ts` - ทถฒ ุฎุท
3. โ `types.ts` - ุจุฑูุฒุฑุณุงู ุดุฏู
4. โ `services/api-supabase.ts` - ุจุฑูุฒุฑุณุงู ุดุฏู (ถ ุชุงุจุน ุงุถุงูู)
5. โ `components/AdminAuctionParticipantsPanel.tsx` - ฑทต ุฎุท
6. โ `components/UserAuctionView.tsx` - ฑฐฐ ุฎุท
7. โ `hooks/useAuctionPaymentChecker.ts` - ฒต ุฎุท
8. โ `AUCTION_GUARANTEE_SYSTEM_IMPLEMENTATION.md` - ณฐฑ ุฎุท
9. โ `AUCTION_GUARANTEE_INTEGRATION_GUIDE.md` - ณฑน ุฎุท

**ฺฉู:** ฒฐณธ ุฎุท ฺฉุฏ ู ูุณุชูุฏุงุช

---

## ูฺฉุงุช ุงุณุชูุงุฏู

### ฑ. ูุนุงูโุณุงุฒ ุฏุฑ App.tsx
```typescript
import useAuctionPaymentChecker from './hooks/useAuctionPaymentChecker';
import useAuctionAutoProcessor from './hooks/useAuctionAutoProcessor';

function App() {
  useAuctionPaymentChecker();      // ุจุฑุฑุณ ูููุชโูุง
  useAuctionAutoProcessor();        // ูพุฑุฏุงุฒุด ุญุฑุงุฌโูุง ุงูุฌุงูโุดุฏู
  return <MainApp />;
}
```

### ฒ. ุงุณุชูุงุฏู ุงุฒ API
```typescript
// ุจุฑุฑุณ ููุฌูุฏ
const balance = await api.checkGuaranteeDepositBalance(userId, auctionId, basePrice);

// ุซุจุช ูพุดููุงุฏ
await api.placeBidWithGuaranteeDeposit(simId, auctionId, bidderId, amount, basePrice);

// ูพุงุงู ุญุฑุงุฌ
await api.processAuctionEnding(auctionId);

// ูพุฑุฏุงุฎุช ุจุฑูุฏู
await api.processAuctionWinnerPayment(winnerQueueId, auctionId);
```

---

## ุขูุงุฑ ูพุงุฏูโุณุงุฒ

| ุจุฎุด | ูุถุนุช | ฺฉุฏ | ูุณุชูุฏุงุช |
|------|-------|-----|----------|
| ุฏุชุงุจุณ | โ ฺฉุงูู | SQL | โ |
| API | โ ฺฉุงูู | TS | โ |
| Components | โ ฺฉุงูู | TSX | โ |
| Hooks | โ ฺฉุงูู | TS | โ |
| Types | โ ฺฉุงูู | TS | โ |
| ูุณุชูุฏุงุช | โ ฺฉุงูู | MD | โ |

---

## ุจุนุฏโูุง

ฑ. **SQL Script ุงุฌุฑุง ฺฉูุฏ** ุฏุฑ Supabase
ฒ. **Hooks ุฑุง ูุนุงู ฺฉูุฏ** ุฏุฑ App.tsx
ณ. **Components ุฑุง ฺฉูพุงุฑฺู ฺฉูุฏ** ุฏุฑ ุตูุญูโูุง ูุฑุจูุทู
ด. **API ุฑุง ุงุณุชูุงุฏู ฺฉูุฏ** ุจุฑุง ุซุจุช ูพุดููุงุฏ

---

ุณุณุชู ุญุฑุงุฌ ุจุง ุถูุงูุชโูุงูู **ฺฉุงูู ู ุขูุงุฏูโ ุงุณุชูุงุฏู** ุงุณุช! ๐
