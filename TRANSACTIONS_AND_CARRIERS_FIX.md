# ุฑูุน ูุดฺฉู ุชุฑุงฺฉูุดโูุง ู ุงุถุงูู ฺฉุฑุฏู ูุฏุฑุช ุงูพุฑุงุชูุฑูุง

## ูุดฺฉู 1: ุชุฑุงฺฉูุดโูุง ุซุจุช ููุดู

### ุนูุช:
RLS (Row Level Security) policies ูุงูุน ุงุฒ ุซุจุช ุชุฑุงฺฉูุดโูุง ูุดู.

### ุฑุงูโุญู:

#### ฺฏุงู 1: ุบุฑูุนุงู ฺฉุฑุฏู RLS
ูุงู `supabase/disable-transactions-rls-completely.sql` ุฑู ุฏุฑ Supabase SQL Editor ุงุฌุฑุง ฺฉู:

```sql
-- ุญุฐู ุชูุงู policies
DROP POLICY IF EXISTS "Users can view their transactions" ON transactions;
DROP POLICY IF EXISTS "Admins can view all transactions" ON transactions;
DROP POLICY IF EXISTS "Allow authenticated users to insert transactions" ON transactions;
DROP POLICY IF EXISTS "Admins can update transactions" ON transactions;

-- ุบุฑูุนุงู ฺฉุฑุฏู RLS
ALTER TABLE transactions DISABLE ROW LEVEL SECURITY;
```

#### ฺฏุงู 2: ุงุถุงูู ฺฉุฑุฏู ุชุฑุงฺฉูุดโูุง ฺฏูุดุฏู
ูุงู `supabase/fix-missing-transactions.sql` ุฑู ุงุฌุฑุง ฺฉู ุชุง ุชุฑุงฺฉูุดโูุง ุณูุงุฑุดุงุช ูุจู ุงุถุงูู ุจุดู.

#### ฺฏุงู 3: ุชุณุช
ฺฉ ุฎุฑุฏ ุฌุฏุฏ ุงูุฌุงู ุจุฏู ู ุจุนุฏ ุงุฒ ุชฺฉููุ ุชุงุฑุฎฺู ุชุฑุงฺฉูุดโูุง ุฑู ฺฺฉ ฺฉู.

---

## ูุดฺฉู 2: ูุฏุฑุช ุงูพุฑุงุชูุฑูุง

### ูุงุจูุช ุฌุฏุฏ:
ุงุฏูู ูโุชููู ุงูพุฑุงุชูุฑูุง ูุฏูุธุฑุด ุฑู ุงุถุงููุ ูุฑุงุดุ ูุนุงู/ุบุฑูุนุงู ู ุญุฐู ฺฉูู.

### ูุตุจ:

#### ฺฏุงู 1: ุงุฌุงุฏ ุฌุฏูู
ูุงู `supabase/create-carriers-table.sql` ุฑู ุฏุฑ Supabase ุงุฌุฑุง ฺฉู:

```sql
CREATE TABLE IF NOT EXISTS carriers (
    id SERIAL PRIMARY KEY,
    name VARCHAR(100) NOT NULL UNIQUE,
    name_fa VARCHAR(100) NOT NULL,
    is_active BOOLEAN DEFAULT true,
    display_order INTEGER DEFAULT 0,
    created_at TIMESTAMP DEFAULT NOW(),
    updated_at TIMESTAMP DEFAULT NOW()
);

-- ุงูพุฑุงุชูุฑูุง ูพุดโูุฑุถ
INSERT INTO carriers (name, name_fa, is_active, display_order) VALUES
('irancell', 'ุงุฑุงูุณู', true, 1),
('mci', 'ููุฑุงู ุงูู', true, 2),
('rightel', 'ุฑุงุชู', true, 3);
```

#### ฺฏุงู 2: ุงุถุงูู ฺฉุฑุฏู ุจู ูพูู ุงุฏูู
ฺฉุงููพูููุช `AdminCarriersManagement.tsx` ุณุงุฎุชู ุดุฏู. ุจุงุฏ ุจู ุฑูุช ุงุฏูู ุงุถุงูู ุจุดู.

ุฏุฑ ูุงู ูุณุฑุงุจ ุงุฏูู (ูุซูุงู `AdminDashboard.tsx` ุง `App.tsx`):

```typescript
import AdminCarriersManagement from '../components/AdminCarriersManagement';

// ุฏุฑ ูุณูุช routes:
<Route path="carriers" element={<AdminCarriersManagement />} />
```

#### ฺฏุงู 3: ุงุถุงูู ฺฉุฑุฏู ููฺฉ ุจู ููู ุงุฏูู
ุฏุฑ ููู ุงุฏููุ ฺฉ ุขุชู ุฌุฏุฏ ุงุถุงูู ฺฉู:

```typescript
{
    path: '/admin/carriers',
    label: '๐ฑ ูุฏุฑุช ุงูพุฑุงุชูุฑูุง',
    icon: '๐ฑ'
}
```

---

## ูุงุจูุชโูุง ูุฏุฑุช ุงูพุฑุงุชูุฑูุง:

1. โ **ูุดุงูุฏู ูุณุช ุงูพุฑุงุชูุฑูุง** - ุจุง ุชุฑุชุจ ููุงุด
2. โ **ุงูุฒูุฏู ุงูพุฑุงุชูุฑ ุฌุฏุฏ** - ุจุง ูุงู ุงูฺฏูุณ ู ูุงุฑุณ
3. โ **ูุฑุงุด ุงูพุฑุงุชูุฑ** - ุชุบุฑ ูุงูุ ุชุฑุชุจ ู ูุถุนุช
4. โ **ูุนุงู/ุบุฑูุนุงู ฺฉุฑุฏู** - ุจุฏูู ุญุฐู ุงุฒ ุฏุชุงุจุณ
5. โ **ุญุฐู ุงูพุฑุงุชูุฑ** - ุญุฐู ฺฉุงูู
6. โ **ุชุฑุชุจ ููุงุด** - ุจุฑุง ูุฑุชุจโุณุงุฒ ุฏุฑ ูุณุชโูุง

---

## ุงุณุชูุงุฏู ุงุฒ ุงูพุฑุงุชูุฑูุง ุฏุฑ ุณุงุช:

ุจุนุฏ ุงุฒ ุงุถุงูู ฺฉุฑุฏู ุงูพุฑุงุชูุฑูุงุ ูโุชูู ุฏุฑ ูุฑูโูุง ุซุจุช ุณูฺฉุงุฑุช ุงุฒ ุงู ูุณุช ุงุณุชูุงุฏู ฺฉู:

```typescript
// ุจุงุฑฺฏุฐุงุฑ ุงูพุฑุงุชูุฑูุง ูุนุงู
const { data: carriers } = await supabase
    .from('carriers')
    .select('*')
    .eq('is_active', true)
    .order('display_order');

// ููุงุด ุฏุฑ dropdown
<select>
    {carriers.map(carrier => (
        <option key={carrier.id} value={carrier.name}>
            {carrier.name_fa}
        </option>
    ))}
</select>
```

---

## ุชุณุช ุณุณุชู:

### ุชุณุช ุชุฑุงฺฉูุดโูุง:
1. ฺฉ ุณูฺฉุงุฑุช ุตูุฑ ุจุฎุฑ
2. ูุฑูุดูุฏู ฺฉุฏ ุฑู ุจูุฑุณุชู
3. ุฎุฑุฏุงุฑ ฺฉุฏ ุฑู ุชุงุฏ ฺฉูู
4. ฺฺฉ ฺฉู ฺฉู ุชุฑุงฺฉูุดโูุง ุฏุฑ ุชุงุฑุฎฺู ูุฑ ุฏู ููุงุด ุฏุงุฏู ูุดู

### ุชุณุช ูุฏุฑุช ุงูพุฑุงุชูุฑูุง:
1. ุจุฑู ุจู ูพูู ุงุฏูู โ ูุฏุฑุช ุงูพุฑุงุชูุฑูุง
2. ฺฉ ุงูพุฑุงุชูุฑ ุฌุฏุฏ ุงุถุงูู ฺฉู (ูุซูุงู "ุชูู ฺฉุด")
3. ูุฑุงุด ฺฉู ู ุชุฑุชุจ ููุงุด ุฑู ุชุบุฑ ุจุฏู
4. ุบุฑูุนุงูุด ฺฉู ู ุจุจู ฺฉู ุฏุฑ ูุณุชโูุง ุนููู ููุงุด ุฏุงุฏู ููุดู
5. ูุนุงูุด ฺฉู ู ุฏูุจุงุฑู ฺฺฉ ฺฉู

---

## ูุงูโูุง ุงุฌุงุฏ ุดุฏู:

### SQL:
- `supabase/check-transaction-rls.sql`
- `supabase/disable-transactions-rls-completely.sql`
- `supabase/fix-missing-transactions.sql`
- `supabase/create-carriers-table.sql`

### Components:
- `components/AdminCarriersManagement.tsx`

---

## ูฺฉุงุช ููู:

1. **RLS**: ุจุนุฏ ุงุฒ ุบุฑูุนุงู ฺฉุฑุฏู RLS ุจุฑุง transactionsุ ููู ฺฉุงุฑุจุฑุงู ูโุชููู ุชุฑุงฺฉูุดโูุง ุฑู ุจุจูู. ุงฺฏุฑ ูโุฎูุง ูุญุฏูุฏุช ุจุฐุงุฑุ ุจุงุฏ policies ุฌุฏุฏ ุจููุณ.

2. **ุงูพุฑุงุชูุฑูุง**: ููุท ุงูพุฑุงุชูุฑูุง ูุนุงู (`is_active = true`) ุฏุฑ ุณุงุช ููุงุด ุฏุงุฏู ูุดู.

3. **ุชุฑุชุจ ููุงุด**: ุนุฏุฏ ฺฉูฺฺฉุชุฑ = ุงูููุช ุจุงูุงุชุฑ

4. **ุญุฐู ุงูพุฑุงุชูุฑ**: ูุจู ุงุฒ ุญุฐูุ ูุทูุฆู ุดู ฺฉู ูฺ ุณูฺฉุงุฑุช ุจุง ุงู ุงูพุฑุงุชูุฑ ุซุจุช ูุดุฏู.
