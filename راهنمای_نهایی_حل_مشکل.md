# ๐ฏ ุฑุงูููุง ููุง ุญู ูุดฺฉู

## ูุดฺฉูุงุช ุดูุง:
1. โ ุณูุงุฑุด 58 ุจู ูุฑูุดูุฏู ูุดูู ุฏุงุฏู ููุดู
2. โ ูููุน ุซุจุช ุดูุงุฑู ุฌุฏุฏ ุงุฑูุฑ ุฏุชุงุจุณ ูุฏู

## ุนูุช:
ุณุงุณุชโูุง ุงููุช RLS (Row Level Security) ุฏุฑ Supabase ุจู ุฏุฑุณุช ุชูุธู ูุดุฏูโุงูุฏ.

---

## โ ุฑุงู ุญู (ููุท 3 ูุฑุญูู!)

### ูุฑุญูู 1๏ธโฃ: ุงุฌุฑุง ุงุณฺฉุฑูพุช SQL

1. ูุงุฑุฏ ูพูู Supabase ุดูุฏ
2. ุจู **SQL Editor** ุจุฑูุฏ
3. ูุงู `supabase/fix-all-rls-policies.sql` ุฑุง ุจุงุฒ ฺฉูุฏ
4. **ุชูุงู ูุญุชูุง ุขู** ุฑุง ฺฉูพ ฺฉูุฏ (Ctrl+A, Ctrl+C)
5. ุฏุฑ SQL Editor ูพุณุช ฺฉูุฏ (Ctrl+V)
6. ุฏฺฉูู **Run** ุฑุง ุจฺฉูฺฉ ฺฉูุฏ
7. ููุชุธุฑ ุจูุงูุฏ ุชุง ูพุบุงู "โ ุชูุงู ุณุงุณุชโูุง RLS ุจุง ููููุช ุงุนูุงู ุดุฏูุฏ!" ุฑุง ุจุจูุฏ

### ูุฑุญูู 2๏ธโฃ: ุงุฌุงุฏ activation_request ุจุฑุง ุณูุงุฑุด 58

ุฏุฑ ููุงู SQL Editorุ ุงู ฺฉูุฆุฑ ุฑุง ุงุฌุฑุง ฺฉูุฏ:

```sql
-- ุงุฌุงุฏ activation_request ุจุฑุง ุณูุงุฑุด 58
INSERT INTO activation_requests (
    purchase_order_id,
    sim_card_id,
    buyer_id,
    seller_id,
    sim_number,
    buyer_name,
    seller_name,
    status
)
SELECT 
    po.id,
    po.sim_card_id,
    po.buyer_id,
    po.seller_id,
    sc.number,
    u_buyer.name,
    u_seller.name,
    'pending'
FROM purchase_orders po
LEFT JOIN sim_cards sc ON sc.id = po.sim_card_id
LEFT JOIN users u_buyer ON u_buyer.id = po.buyer_id
LEFT JOIN users u_seller ON u_seller.id = po.seller_id
WHERE po.id = 58
AND NOT EXISTS (
    SELECT 1 FROM activation_requests WHERE purchase_order_id = 58
);
```

### ูุฑุญูู 3๏ธโฃ: ุฎุฑูุฌ ู ูุฑูุฏ ูุฌุฏุฏ

1. ุงุฒ ุญุณุงุจ ูุฑูุดูุฏู **ุฎุงุฑุฌ ุดูุฏ** (Logout)
2. **ุฏูุจุงุฑู ูุงุฑุฏ ุดูุฏ** (Login)
3. ุจู ุฏุงุดุจูุฑุฏ ูุฑูุดูุฏู ุจุฑูุฏ
4. ุฑู "ุฎุทูุท ุตูุฑ - ุณูุงุฑุดุงุช" ฺฉูฺฉ ฺฉูุฏ

---

## ๐งช ุชุณุช ฺฉูุฏ

### ุชุณุช 1: ููุงุด ุณูุงุฑุด
- โ ุณูุงุฑุด 58 ุจุงุฏ ููุงุด ุฏุงุฏู ุดูุฏ
- โ ุจุงุฏ ููุฏ ุจุฑุง ูุงุฑุฏ ฺฉุฑุฏู ฺฉุฏ 6 ุฑูู ุฑุง ุจุจูุฏ

### ุชุณุช 2: ุซุจุช ุดูุงุฑู ุฌุฏุฏ
1. ุจู ุจุฎุด "ุงูุฒูุฏู ุณูฺฉุงุฑุช" ุจุฑูุฏ
2. ฺฉ ุดูุงุฑู ุชุณุช ูุงุฑุฏ ฺฉูุฏ (ูุซูุงู 09123456789)
3. ููุช ู ุณุงุฑ ุงุทูุงุนุงุช ุฑุง ูุงุฑุฏ ฺฉูุฏ
4. ุฏฺฉูู "ุซุจุช" ุฑุง ุจฺฉูฺฉ ฺฉูุฏ
5. โ ุจุงุฏ ูพุบุงู ููููุช ุฑุง ุจุจูุฏ (ุจุฏูู ุงุฑูุฑ ุฏุชุงุจุณ)

---

## ๐ ฺู ฺฉุงุฑ ุงูุฌุงู ุดุฏุ

ุงู ุงุณฺฉุฑูพุช ุณุงุณุชโูุง RLS ุฑุง ุจุฑุง **13 ุฌุฏูู** ุงุตูุงุญ ฺฉุฑุฏ:

1. โ `sim_cards` - ุซุจุช ู ูุฏุฑุช ุณูฺฉุงุฑุชโูุง
2. โ `purchase_orders` - ููุงุด ุณูุงุฑุดุงุช
3. โ `activation_requests` - ุฏุฑุฎูุงุณุชโูุง ูุนุงูโุณุงุฒ
4. โ `transactions` - ุชุฑุงฺฉูุดโูุง ูุงู
5. โ `users` - ูพุฑููุงู ฺฉุงุฑุจุฑุงู
6. โ `notifications` - ููุชูฺฉุดูโูุง
7. โ `auction_details` - ุฌุฒุฆุงุช ุญุฑุงุฌ
8. โ `bids` - ูพุดููุงุฏุงุช ุญุฑุงุฌ
9. โ `payment_receipts` - ุฑุณุฏูุง ูพุฑุฏุงุฎุช
10. โ `support_messages` - ูพุงูโูุง ูพุดุชุจุงู
11. โ `packages` - ูพฺฉุฌโูุง
12. โ `commissions` - ฺฉูุณููโูุง
13. โ `secure_payments` - ูพุฑุฏุงุฎุชโูุง ุงูู

---

## โ ุงฺฏุฑ ูููุฒ ฺฉุงุฑ ูฺฉุฑุฏ

### ฺฏุงู 1: ุจุฑุฑุณ ุงุฌุฑุง ุงุณฺฉุฑูพุช

ุฏุฑ SQL Editor ุงู ฺฉูุฆุฑ ุฑุง ุงุฌุฑุง ฺฉูุฏ:

```sql
-- ุจุฑุฑุณ ุชุนุฏุงุฏ ุณุงุณุชโูุง ูุฑ ุฌุฏูู
SELECT 
    tablename,
    COUNT(*) as policy_count
FROM pg_policies 
WHERE schemaname = 'public'
GROUP BY tablename
ORDER BY tablename;
```

ุจุงุฏ ุจุจูุฏ:
- `sim_cards`: 4 ุณุงุณุช
- `purchase_orders`: 5 ุณุงุณุช
- `activation_requests`: 5 ุณุงุณุช
- ู ุบุฑู...

### ฺฏุงู 2: ุจุฑุฑุณ ุณูุงุฑุด 58

```sql
SELECT 
    po.id,
    po.seller_id,
    po.status,
    sc.number,
    ar.id as activation_request_id
FROM purchase_orders po
LEFT JOIN sim_cards sc ON sc.id = po.sim_card_id
LEFT JOIN activation_requests ar ON ar.purchase_order_id = po.id
WHERE po.id = 58;
```

ุจุงุฏ ฺฉ ุฑฺฉูุฑุฏ ุจุง `activation_request_id` ุจุจูุฏ.

### ฺฏุงู 3: ุจุฑุฑุณ ฺฉูุณูู ูุฑูุฑฺฏุฑ

1. F12 ุฑุง ุจุฒูุฏ
2. ุจู ุชุจ Console ุจุฑูุฏ
3. ุตูุญู ุฑุง ุฑูุฑุด ฺฉูุฏ
4. ุจู ุฏูุจุงู ุงุฑูุฑูุง ูุฑูุฒ ุจฺฏุฑุฏุฏ
5. ุงุณฺฉุฑูโุดุงุช ุจฺฏุฑุฏ ู ุจุฑุง ูู ุจูุฑุณุชุฏ

---

## ๐ ุจุนุฏ ุงุฒ ุญู ูุดฺฉู

ููู ฺุฒ ุจุงุฏ ฺฉุงุฑ ฺฉูุฏ:
- โ ูุฑูุดูุฏู ูโุชูุงูุฏ ุณูุงุฑุดุงุช ุฎูุฏ ุฑุง ุจุจูุฏ
- โ ูุฑูุดูุฏู ูโุชูุงูุฏ ุดูุงุฑู ุฌุฏุฏ ุซุจุช ฺฉูุฏ
- โ ุฎุฑุฏุงุฑ ูโุชูุงูุฏ ุฎุฑุฏ ฺฉูุฏ
- โ ุณุณุชู ูุนุงูโุณุงุฒ ฺฉุงุฑ ูโฺฉูุฏ
- โ ูพุฑุฏุงุฎุชโูุง ุงูุฌุงู ูโุดููุฏ

---

## ๐ ูพุดุชุจุงู

ุงฺฏุฑ ุจุนุฏ ุงุฒ ุงูุฌุงู ุชูุงู ูุฑุงุญู ูููุฒ ูุดฺฉู ุฏุงุฑุฏ:

1. ุฎุฑูุฌ SQL Editor ุฑุง ฺฉูพ ฺฉูุฏ
2. ุงุณฺฉุฑูโุดุงุช ุงุฒ ฺฉูุณูู ูุฑูุฑฺฏุฑ ุจฺฏุฑุฏ
3. ุงุฑูุฑ ุฏูู ุฑุง ุจุฑุง ูู ุจูุฑุณุชุฏ

**ููู:** ุญุชูุงู ุงุฒ ุญุณุงุจ ูุฑูุดูุฏู ุฎุงุฑุฌ ุดูุฏ ู ุฏูุจุงุฑู ูุงุฑุฏ ุดูุฏ!
