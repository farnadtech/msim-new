# راهنمای سیستم فاکتور

## خلاصه

یک سیستم فاکتور کامل و حرفه‌ای با قابلیت چاپ برای خریداران و فروشندگان پیاده‌سازی شده است.

## فایل‌های ایجاد شده

### 1. کامپوننت فاکتور
**`components/Invoice.tsx`**
- کامپوننت اصلی نمایش فاکتور
- قابلیت چاپ با استایل حرفه‌ای
- پشتیبانی از 3 نوع فاکتور:
  - 🛒 فاکتور خرید (برای خریدار)
  - 🏪 فاکتور فروش (برای فروشنده)
  - 💰 فاکتور کمیسیون (برای فروشنده)

### 2. صفحه لیست فاکتورها
**`pages/InvoicesPage.tsx`**
- نمایش لیست تمام فاکتورها
- تب‌های جداگانه برای خرید، فروش و کمیسیون
- جدول با اطلاعات کامل
- دکمه مشاهده و چاپ فاکتور

### 3. تغییرات در فایل‌های موجود
- **`App.tsx`**: اضافه شدن route برای `/invoices`
- **`components/Header.tsx`**: اضافه شدن لینک "📄 فاکتورهای من" در منوی کاربر
- **`pages/BuyerDashboard.tsx`**: اضافه شدن لینک فاکتورها در منوی سایدبار
- **`pages/SellerDashboard.tsx`**: اضافه شدن لینک فاکتورها در منوی سایدبار
- **`pages/AdminDashboard.tsx`**: اضافه شدن لینک فاکتورها در منوی سایدبار

## ویژگی‌های فاکتور

### طراحی حرفه‌ای
- ✅ هدر با لوگو و اطلاعات سایت
- ✅ شماره فاکتور یکتا
- ✅ تاریخ صدور به شمسی
- ✅ اطلاعات خریدار و فروشنده
- ✅ جدول اقلام با جزئیات کامل
- ✅ محاسبات دقیق (مبلغ، کمیسیون، مبلغ نهایی)
- ✅ بخش امضا برای خریدار و فروشنده
- ✅ فوتر با اطلاعات تماس و تاریخ چاپ

### قابلیت چاپ
- 🖨️ دکمه چاپ در بالای فاکتور
- 🖨️ استایل بهینه برای چاپ
- 🖨️ حذف خودکار دکمه‌ها در حالت چاپ
- 🖨️ فونت و اندازه مناسب برای چاپ A4

### پشتیبانی از زبان فارسی
- 📝 تمام متن‌ها به فارسی
- 📝 اعداد به فرمت فارسی
- 📝 تاریخ به شمسی
- 📝 راست‌چین و مناسب برای فارسی

## نحوه استفاده

### برای کاربران

#### 1. دسترسی به فاکتورها
کاربران می‌توانند از 3 مسیر به فاکتورهای خود دسترسی داشته باشند:

**الف) از منوی بالا:**
- کلیک روی نام کاربری
- انتخاب "📄 فاکتورهای من"

**ب) از داشبورد:**
- ورود به پنل کاربری (خریدار/فروشنده/ادمین)
- کلیک روی "📄 فاکتورهای من" در منوی سایدبار

**ج) مستقیم:**
- رفتن به آدرس: `/#/invoices`

#### 2. مشاهده فاکتورها
در صفحه فاکتورها، 3 تب وجود دارد:

**🛒 خریدهای من:**
- لیست تمام خریدهای کاربر
- شامل: شماره فاکتور، تاریخ، مبلغ، وضعیت
- دکمه "مشاهده فاکتور" برای هر خرید

**🏪 فروش‌های من:**
- لیست تمام فروش‌های کاربر (فقط برای فروشندگان)
- شامل: شماره فاکتور، تاریخ، مبلغ دریافتی، وضعیت
- دکمه "مشاهده فاکتور" برای هر فروش

**💰 کمیسیون‌ها:**
- لیست تمام کمیسیون‌های کسر شده (فقط برای فروشندگان)
- شامل: شماره فاکتور، تاریخ، شماره سیم‌کارت، مبلغ فروش، کمیسیون، مبلغ دریافتی
- دکمه "مشاهده فاکتور" برای هر کمیسیون

#### 3. چاپ فاکتور
- کلیک روی "مشاهده فاکتور"
- در پنجره باز شده، کلیک روی "🖨️ چاپ فاکتور"
- پنجره چاپ مرورگر باز می‌شود
- انتخاب چاپگر و تنظیمات
- چاپ یا ذخیره به PDF

### برای توسعه‌دهندگان

#### استفاده از کامپوننت Invoice

```tsx
import Invoice from '../components/Invoice';

// برای فاکتور خرید
<Invoice
    type="purchase"
    data={purchaseOrder}
    simCard={simCard}
    buyer={buyer}
    seller={seller}
    invoiceNumber="INV-123"
    onClose={() => setShowInvoice(false)}
/>

// برای فاکتور فروش
<Invoice
    type="sale"
    data={purchaseOrder}
    simCard={simCard}
    buyer={buyer}
    seller={seller}
    invoiceNumber="INV-123"
    onClose={() => setShowInvoice(false)}
/>

// برای فاکتور کمیسیون
<Invoice
    type="commission"
    data={commission}
    invoiceNumber="COM-456"
    onClose={() => setShowInvoice(false)}
/>
```

#### Props کامپوننت Invoice

```typescript
interface InvoiceProps {
    type: 'purchase' | 'sale' | 'commission';  // نوع فاکتور
    data: Commission | PurchaseOrder;          // داده‌های فاکتور
    simCard?: SimCard;                         // اطلاعات سیم‌کارت (اختیاری)
    buyer?: User;                              // اطلاعات خریدار (اختیاری)
    seller?: User;                             // اطلاعات فروشنده (اختیاری)
    invoiceNumber?: string;                    // شماره فاکتور (اختیاری)
    onClose?: () => void;                      // تابع بستن مودال (اختیاری)
}
```

## ساختار فاکتور

### فاکتور خرید (Purchase Invoice)
```
┌─────────────────────────────────────────┐
│         🏪 MSIM724                      │
│    فاکتور رسمی خرید و فروش سیم‌کارت    │
├─────────────────────────────────────────┤
│ شماره: INV-123  │ تاریخ: 1404/11/24    │
├─────────────────────────────────────────┤
│ 🛒 خریدار        │ 🏪 فروشنده          │
│ نام: علی احمدی   │ نام: رضا محمدی      │
├─────────────────────────────────────────┤
│ ردیف │ شرح │ شماره │ نوع │ مبلغ        │
│  1   │ خرید│ 0912..│ فعال│ 1,000,000   │
├─────────────────────────────────────────┤
│ مبلغ خرید:              1,000,000 تومان │
│ وضعیت:                  ✅ تکمیل شده    │
│ ─────────────────────────────────────── │
│ مبلغ قابل پرداخت:       1,000,000 تومان │
├─────────────────────────────────────────┤
│ امضای خریدار    │ امضای فروشنده        │
└─────────────────────────────────────────┘
```

### فاکتور کمیسیون (Commission Invoice)
```
┌─────────────────────────────────────────┐
│         🏪 MSIM724                      │
│    فاکتور رسمی خرید و فروش سیم‌کارت    │
├─────────────────────────────────────────┤
│ شماره: COM-456  │ تاریخ: 1404/11/24    │
├─────────────────────────────────────────┤
│ 🛒 خریدار        │ 🏪 فروشنده          │
│ نام: علی احمدی   │ نام: رضا محمدی      │
├─────────────────────────────────────────┤
│ ردیف │ شرح │ شماره │ نوع │ مبلغ        │
│  1   │ فروش│ 0912..│ حراجی│ 1,000,000  │
├─────────────────────────────────────────┤
│ مبلغ فروش:              1,000,000 تومان │
│ کمیسیون سایت (2%):     -   20,000 تومان│
│ ─────────────────────────────────────── │
│ مبلغ دریافتی فروشنده:    980,000 تومان │
├─────────────────────────────────────────┤
│ امضای خریدار    │ امضای فروشنده        │
└─────────────────────────────────────────┘
```

## استایل چاپ

فاکتور با استایل‌های زیر برای چاپ بهینه شده است:

```css
@media print {
    /* حذف دکمه‌ها */
    .no-print { display: none; }
    
    /* حاشیه صفر */
    body { padding: 0; }
    
    /* فونت مناسب */
    font-family: 'Tahoma', 'Arial', sans-serif;
    
    /* اندازه مناسب برای A4 */
    max-width: 800px;
}
```

## نکات مهم

### برای کاربران
- ✅ فاکتورها به صورت خودکار ایجاد می‌شوند
- ✅ هر خرید/فروش یک فاکتور دارد
- ✅ فاکتورها قابل چاپ و ذخیره هستند
- ✅ شماره فاکتور یکتا است

### برای توسعه‌دهندگان
- ✅ کامپوننت کاملاً مستقل است
- ✅ استایل inline برای چاپ
- ✅ پشتیبانی از Dark Mode در نمایش
- ✅ Responsive برای موبایل

## تست کردن

### تست دستی

1. **ورود به سیستم:**
   - وارد حساب کاربری شوید

2. **خرید یک سیم‌کارت:**
   - یک سیم‌کارت بخرید یا در حراجی شرکت کنید

3. **مشاهده فاکتور:**
   - به صفحه فاکتورها بروید
   - فاکتور خرید خود را مشاهده کنید

4. **چاپ فاکتور:**
   - روی "مشاهده فاکتور" کلیک کنید
   - روی "چاپ فاکتور" کلیک کنید
   - فاکتور را چاپ یا ذخیره کنید

### تست برای فروشنده

1. **فروش سیم‌کارت:**
   - یک سیم‌کارت ثبت و بفروشید

2. **مشاهده فاکتور فروش:**
   - به تب "فروش‌های من" بروید
   - فاکتور فروش را مشاهده کنید

3. **مشاهده فاکتور کمیسیون:**
   - به تب "کمیسیون‌ها" بروید
   - فاکتور کمیسیون را مشاهده کنید

## مشکلات احتمالی و راه‌حل

### مشکل: فاکتور چاپ نمی‌شود
**راه‌حل:**
- مطمئن شوید که مرورگر اجازه باز کردن پنجره جدید را دارد
- Pop-up blocker را غیرفعال کنید

### مشکل: استایل در چاپ درست نیست
**راه‌حل:**
- از مرورگر Chrome یا Firefox استفاده کنید
- در تنظیمات چاپ، "Background graphics" را فعال کنید

### مشکل: اعداد فارسی نمایش داده نمی‌شوند
**راه‌حل:**
- مطمئن شوید که `toLocaleString('fa-IR')` استفاده شده است
- فونت مناسب برای فارسی نصب باشد

## به‌روزرسانی‌های آینده

- [ ] اضافه کردن QR Code به فاکتور
- [ ] ارسال فاکتور به ایمیل
- [ ] دانلود فاکتور به PDF
- [ ] فاکتور جمعی برای چند خرید
- [ ] قالب‌های مختلف فاکتور

---

**تاریخ ایجاد:** 2025-02-13  
**نسخه:** 1.0.0  
**وضعیت:** ✅ آماده برای استفاده
